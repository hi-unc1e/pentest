#!/bin/sh
init() {
    set -o noglob

}


install_semgrep() {
    set -x

    pip3 install semgrep
    semgrep login
    semgrep install-semgrep-pro
}


clone_git() {
set -x

    # https://github.com/xx/modoboa
    url=$1
    git clone $url

    name=$(echo $url |cut -d "/" -f5)
    cd "$name"

set +x
}

scan_semgrep() {
    set -x
    
    ext=$1
    lang_conf=""
    if [ -n "$ext" ]; then
        lang_conf="--include=*.${ext}"
    fi
    
    semgrep scan $lang_conf --pro --config auto --max-memory 2000 --sarif --time -o scan_result.sarif 
    
    set +x
}


scan_semgrep_ci() {
    # 
set -x
    ext=$1
    lang_conf=""
    if [ -n "$ext" ]; then
        lang_conf="--include=*.$ext"
    fi
    semgrep ci $lang_conf --pro --max-memory 2000  --sarif --time -o scan_result.sarif 
set +x

}