import os
import http.server
import socketserver

class WebDAVRequestHandler(http.server.SimpleHTTPRequestHandler):

    def do_OPTIONS(self):
        self.send_response(200, "OK")
        self.send_header("DAV", "1")
        self.send_header("Allow", "OPTIONS, GET, PUT, DELETE, PROPFIND")
        self.send_header("Content-Length", 0)
        self.end_headers()

    def do_PROPFIND(self):
        response = '''<?xml version="1.0" encoding="utf-8" ?>
        <D:multistatus xmlns:D="DAV:">
            <D:response>
                <D:href>/</D:href>
                <D:propstat>
                    <D:prop>
                        <D:resourcetype><D:collection/></D:resourcetype>
                    </D:prop>
                    <D:status>HTTP/1.1 200 OK</D:status>
                </D:propstat>
            </D:response>
        </D:multistatus>'''

        self.send_response(207, "Multi-Status")
        self.send_header("Content-Type", "text/xml; charset=utf-8")
        self.send_header("Content-Length", len(response))
        self.end_headers()
        self.wfile.write(response.encode())

    def do_PUT(self):
        length = int(self.headers.get("Content-Length"))
        content = self.rfile.read(length)

        with open(self.path.lstrip("/"), "wb") as f:
            f.write(content)

        self.send_response(201, "Created")
        self.end_headers()

    def do_DELETE(self):
        try:
            os.remove(self.path.lstrip("/"))
            self.send_response(204, "No Content")
        except FileNotFoundError:
            self.send_response(404, "Not Found")

        self.end_headers()

if __name__ == "__main__":
    PORT = 8000
    Handler = WebDAVRequestHandler
    httpd = socketserver.TCPServer(("", PORT), Handler)
    print(f"Serving on port {PORT}")
    httpd.serve_forever()
